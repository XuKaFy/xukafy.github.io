<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>ã€æ‚è®°ã€‘Cnss Recruit 2021 wps of Dev - XuKaFy&#39;s Blog</title><meta name="Description" content="ä¸€äº›å°å¸®åŠ©"><meta property="og:title" content="ã€æ‚è®°ã€‘Cnss Recruit 2021 wps of Dev" />
<meta property="og:description" content="è¿™æ˜¯Cnss Recruit 2021ï¼ŒDevæ–¹å‘çš„write-upsã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://xukafy.github.io/posts/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0cnss-recruit-2021-wps-of-dev/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-01T18:45:05+00:00" />
<meta property="article:modified_time" content="2021-11-01T18:45:05+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ã€æ‚è®°ã€‘Cnss Recruit 2021 wps of Dev"/>
<meta name="twitter:description" content="è¿™æ˜¯Cnss Recruit 2021ï¼ŒDevæ–¹å‘çš„write-upsã€‚"/>
<meta name="application-name" content="XuKaFy&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="XuKaFy&#39;s Blog"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://xukafy.github.io/posts/%E6%9D%82%E8%AE%B0/%E6%9D%82%E8%AE%B0cnss-recruit-2021-wps-of-dev/" /><link rel="prev" href="http://xukafy.github.io/posts/%E6%96%B0%E6%89%8B%E5%90%91/%E6%96%B0%E6%89%8B%E5%90%91stm32%E5%85%A5%E9%97%A8/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "ã€æ‚è®°ã€‘Cnss Recruit 2021 wps of Dev",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/xukafy.github.io\/posts\/%E6%9D%82%E8%AE%B0\/%E6%9D%82%E8%AE%B0cnss-recruit-2021-wps-of-dev\/"
        },"genre": "posts","keywords": "Dev, Cnss Recruit","wordcount":  5645 ,
        "url": "http:\/\/xukafy.github.io\/posts\/%E6%9D%82%E8%AE%B0\/%E6%9D%82%E8%AE%B0cnss-recruit-2021-wps-of-dev\/","datePublished": "2021-11-01T18:45:05+00:00","dateModified": "2021-11-01T18:45:05+00:00","publisher": {
            "@type": "Organization",
            "name": "XuKaFy"},"author": {
                "@type": "Person",
                "name": "XuKaFy"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="XuKaFy&#39;s Blog">XuKaFy&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ–‡ç«  </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="XuKaFy&#39;s Blog">XuKaFy&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">æ–‡ç« </a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">ã€æ‚è®°ã€‘Cnss Recruit 2021 wps of Dev</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>XuKaFy</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/%E6%9D%82%E8%AE%B0/"><i class="far fa-folder fa-fw"></i>æ‚è®°</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-11-01">2021-11-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 5645 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 12 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#hello-world">ğŸ¥Hello World</a></li>
    <li><a href="#deathloop">ğŸ”—Deathloop</a></li>
    <li><a href="#constant">ğŸ§±Constant</a></li>
    <li><a href="#primes">ğŸ§®Primes</a></li>
    <li><a href="#trace-it">ğŸ•Trace it!</a></li>
    <li><a href="#hello-bravenewworld">ğŸ­Hello BraveNewWorld</a></li>
    <li><a href="#proxy-with-cache">ğŸ“²Proxy with Cache</a></li>
    <li><a href="#è®¡ç®—å™¨">ğŸ˜˜è®¡ç®—å™¨</a></li>
    <li><a href="#lost-in-interpretation">ğŸ—¼Lost in Interpretation</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>è¿™æ˜¯<code>Cnss Recruit 2021</code>ï¼Œ<code>Dev</code>æ–¹å‘çš„write-upsã€‚</p>
<h2 id="hello-world">ğŸ¥Hello World</h2>
<blockquote>
<p>ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€è¾“å‡º<code>&quot;Hello World&quot;</code>ã€‚</p>
</blockquote>
<p>æ¨èå†™å†™<code>c/c++</code>ã€<code>javascript</code>ã€<code>python</code>ã€<code>lua</code>ã€<code>go</code>å’Œ<code>scheme</code>ã€‚</p>
<h2 id="deathloop">ğŸ”—Deathloop</h2>
<blockquote>
<p>å°è¯•ç”¨æŸç§è¯­è¨€è¿›è¡Œå¹¶å‘æ•°ç»„æ±‚å’Œï¼Œå¹¶ä¸”èƒ½å¤Ÿæ¯”è¾ƒä¸å•çº¿ç¨‹æ±‚å’Œçš„æ•ˆç‡å·®åˆ«ã€‚</p>
</blockquote>
<p>èŠ±ä¸€å¤©æ—¶é—´å­¦ä¸€ä¸‹<code>go</code>ï¼Œä½ å°±èƒ½åšè¿™é¢˜ã€‚</p>
<p>ï¼ˆè¿™å¹¶ä¸æ˜¯è¯´ä½ èƒ½åœ¨ä¸€å¤©å†…ç²¾é€š<code>go</code>ï¼Œè€Œæ˜¯ä½ å…‰æ˜¯ç¿»ä½ è¦ç”¨çš„å‡½æ•°çš„æ–‡æ¡£å°±è¦ç¿»ä¸€å¤©ï¼‰</p>
<p><code>main.go</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;fmt&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">sum</span><span class="p">(</span><span class="nx">begin</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">end</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="o">:=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">begin</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">end</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">s</span> <span class="o">+=</span> <span class="nx">i</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">s</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">newSum</span><span class="p">(</span><span class="nx">begin</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">end</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="nx">l</span> <span class="o">:=</span> <span class="nx">end</span> <span class="o">-</span> <span class="nx">begin</span>
    <span class="nx">N</span> <span class="o">:=</span> <span class="mi">5</span>
    <span class="nx">n</span> <span class="o">:=</span> <span class="nx">l</span> <span class="o">/</span> <span class="nx">N</span>

    <span class="kd">var</span> <span class="nx">ch</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ch</span> <span class="o">&lt;-</span> <span class="nf">sum</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span> <span class="nx">n</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">n</span><span class="p">)</span>
        <span class="p">}</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">ch</span> <span class="o">&lt;-</span> <span class="nf">sum</span><span class="p">((</span><span class="nx">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span>
    <span class="p">}</span> <span class="p">()</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">s</span> <span class="o">+=</span> <span class="o">&lt;-</span> <span class="nx">ch</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">s</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">MAXN</span> <span class="kt">int</span> <span class="p">=</span> <span class="mi">1145141919</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%d\n&#34;</span><span class="p">,</span> <span class="nf">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">MAXN</span><span class="p">))</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%d\n&#34;</span><span class="p">,</span> <span class="nf">newSum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">MAXN</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div><p><code>main_test.go</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;testing&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">BenchmarkSum</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">b</span><span class="p">.</span><span class="nf">ResetTimer</span><span class="p">()</span>
    <span class="nx">b</span><span class="p">.</span><span class="nf">StopTimer</span><span class="p">()</span>

    <span class="kd">const</span> <span class="nx">MAXN</span> <span class="kt">int</span> <span class="p">=</span> <span class="mi">1145141919</span>

    <span class="nx">b</span><span class="p">.</span><span class="nf">StartTimer</span><span class="p">()</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nf">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">MAXN</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">BenchmarkNewSum</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">b</span><span class="p">.</span><span class="nf">ResetTimer</span><span class="p">()</span>
    <span class="nx">b</span><span class="p">.</span><span class="nf">StopTimer</span><span class="p">()</span>

    <span class="kd">const</span> <span class="nx">MAXN</span> <span class="kt">int</span> <span class="p">=</span> <span class="mi">1145141919</span>

    <span class="nx">b</span><span class="p">.</span><span class="nf">StartTimer</span><span class="p">()</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nf">newSum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">MAXN</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="constant">ğŸ§±Constant</h2>
<blockquote>
<p>å®ç°ä¸€ä¸ª<code>Vernam</code>ç®—æ³•ï¼Œå¹¶ä¸”ä¿è¯ä»£ç çš„å¯è¯»æ€§ã€‚</p>
</blockquote>
<p>ä½ éœ€è¦çŸ¥é“<code>pylint</code>å’Œ<code>python</code>çš„è¯­è¨€è§„èŒƒã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="s1">&#39;&#39;&#39;Vernam Cipher åŠ å¯†è§£å¯†å™¨
</span><span class="s1">
</span><span class="s1">ç¨‹åºå¼€å§‹æ—¶ï¼Œå°†ä¼šæç¤ºè¾“å…¥åŠ å¯†æˆ–è§£å¯†ï¼Œæ­¤æ—¶ï¼Œæ‚¨åªèƒ½è¾“å…¥encodeæˆ–è€…decodeæ¥è¿›è¡Œä¸‹ä¸€æ­¥ã€‚
</span><span class="s1">å¦‚æœè¾“å…¥encodeï¼Œè¯·æŒ‰ç…§æç¤ºåˆ†åˆ«è¾“å…¥åŸæ–‡å’Œå¯†é’¥ï¼Œå¹¶ä¸”å¦¥å–„å­˜å‚¨ç¨‹åºè¾“å‡ºçš„å¯†æ–‡ã€‚å¯†æ–‡å½¢å¦‚A#Bï¼ŒAä¸ºåŸæ–‡é•¿åº¦ï¼ŒBä¸ºåŠ å¯†åçš„å¯†æ–‡ã€‚
</span><span class="s1">å¦‚æœè¾“å…¥decodeï¼Œè¯·æŒ‰ç…§æç¤ºåˆ†åˆ«è¾“å…¥ç”±æœ¬ç¨‹åºåŠ å¯†åäº§ç”Ÿçš„å¯†æ–‡å’ŒåŠ å¯†æ—¶æ‰€ç”¨çš„å¯†é’¥ï¼Œç¨‹åºå°†ä¼šè¾“å‡ºåŸæ–‡ã€‚
</span><span class="s1">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">long_to_bytes</span><span class="p">,</span> <span class="n">bytes_to_long</span>

<span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="s1">&#39;&#39;&#39;å°† text ä½¿ç”¨ key åŠ å¯†ã€‚
</span><span class="s1">
</span><span class="s1">    text å’Œ key éƒ½åº”è¯¥æ˜¯ç±»å‹ strã€‚&#39;&#39;&#39;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span> <span class="c1"># å°† key é‡å¤ï¼Œè¡¥å…¨åˆ°é•¿åº¦è‡³å°‘å’ŒåŸæ–‡ä¸€è‡´</span>

    <span class="c1"># ç”±äºåŠ å¯†åçš„æ•°æ®å¹¶ä¸èƒ½æ¨å‡ºåŸæœ¬æ•°æ®çš„å¤§å°</span>
    <span class="c1"># æ‰€ä»¥åœ¨å¯†æ–‡å‰é™„å¸¦åŸæ–‡çš„é•¿åº¦ï¼Œå¹¶ä¸”ç”¨ &#39;#&#39; éš”å¼€</span>

    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&#34;#&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span> <span class="o">^</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>

<span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="s1">&#39;&#39;&#39;å°† ciphertext ä½¿ç”¨ key è§£å¯†ã€‚
</span><span class="s1">
</span><span class="s1">    ciphertext ç±»å‹ä¸º str å¹¶ä¸”å½¢å¼ä¸º A#Bï¼Œå…¶ä¸­ Aã€B å‡ä¸ºæ•´æ•°ï¼Œè€Œ key ç±»å‹ä¸º strã€‚&#39;&#39;&#39;</span>
    <span class="n">len_text</span><span class="p">,</span> <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">ciphertext</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># å°† ciphertext å’Œ len_text åˆ†åˆ«è½¬åŒ–ä¸ºæ•°å­—</span>
        <span class="n">ciphertext</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span>
        <span class="n">len_text</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">len_text</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="c1"># è½¬åŒ–å¤±è´¥ï¼Œè¯´æ˜ Aã€B è‡³å°‘æœ‰ä¸€ä¸ªä¸æ˜¯æ•´æ•°ï¼Œä¹Ÿå°±æ˜¯æ ¼å¼é”™è¯¯</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;æ‚¨è¾“å…¥çš„å¯†æ–‡æ ¼å¼æœ‰è¯¯&#34;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&#34;&#34;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">len_text</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>  <span class="c1"># å°† key é‡å¤ï¼Œè¡¥å…¨åˆ°é•¿åº¦è‡³å°‘å’ŒåŸæ–‡ä¸€è‡´</span>

    <span class="k">return</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">ciphertext</span> <span class="o">^</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="c1"># ç¨‹åºä»è¿™é‡Œå¼€å§‹</span>
<span class="n">mode</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;æ‚¨éœ€è¦åŠ å¯†è¿˜æ˜¯è§£å¯†ï¼ˆencode/decodeï¼‰ï¼š&#34;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&#34;encode&#34;</span><span class="p">:</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;è¯·è¾“å…¥åŸæ–‡ï¼š&#34;</span><span class="p">)</span>
    <span class="n">arg2</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;è¯·è¾“å…¥å¯†é’¥ï¼š&#34;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;å¯†æ–‡æ˜¯ï¼š&#34;</span><span class="p">,</span> <span class="n">encode</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">))</span>

<span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&#34;decode&#34;</span><span class="p">:</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;è¯·è¾“å…¥å¯†æ–‡ï¼š&#34;</span><span class="p">)</span>
    <span class="n">arg2</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;è¯·è¾“å…¥å¯†é’¥ï¼š&#34;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;åŸæ–‡æ˜¯ï¼š&#34;</span><span class="p">,</span> <span class="n">decode</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">))</span>
</code></pre></div><h2 id="primes">ğŸ§®Primes</h2>
<blockquote>
<p>ä½¿ç”¨<code>Linux</code>ä¸‹çš„<code>pipe</code>å’Œ<code>folk</code>å‡½æ•°ï¼Œå®ç°ç´ æ•°æ±‚è§£ã€‚</p>
</blockquote>
<p>å¤§è‡´ç®—æ³•è§£é‡Šï¼š</p>
<ul>
<li>å‡è®¾æ¯ä¸ªæ•°å­—æ˜¯ä¸€ä¸ªäººã€‚</li>
<li>ä¸€å¼€å§‹åœºä¸Šåªæœ‰ä¸€ä¸ªäºº<code>2</code>ã€‚</li>
<li>æ¥ç€<code>3</code>å…¥åœºï¼Œåˆ°<code>2</code>çš„é¢å‰æ¥å—<code>2</code>çš„æ£€æŸ¥ï¼šå¦‚æœ<code>2</code>ä¸èƒ½æ•´é™¤<code>3</code>ï¼Œé‚£ä¹ˆ<code>3</code>æ’åˆ°<code>2</code>çš„åé¢ã€‚ç°åœ¨åœºä¸Šæœ‰<code>2</code>å’Œ<code>3</code>ã€‚</li>
<li>æ¥ç€<code>4</code>å…¥åœºï¼Œåˆ°<code>2</code>çš„é¢å‰æ¥å—æ£€æŸ¥ã€‚ç”±äº$2|4$ï¼Œ<code>4</code>ç¦»å¼€åœºåœ°ã€‚</li>
<li>æ¥ç€<code>5</code>å…¥åœºï¼Œä¾æ¬¡æ¥å—<code>2</code>å’Œ<code>3</code>çš„æ£€æŸ¥åï¼Œæ’åˆ°<code>3</code>çš„åé¢ã€‚ç°åœ¨åœºä¸Šæœ‰<code>2</code>ã€<code>3</code>å’Œ<code>5</code>ã€‚</li>
<li>â€¦â€¦</li>
<li>æ¥ç€<code>n</code>å…¥åœºï¼Œä¾æ¬¡æ¥å—æ‰€æœ‰å°äº<code>n</code>çš„ç´ æ•°äººçš„æ£€æŸ¥ï¼Œå¦‚æœä¸é€šè¿‡å°±ç¦»åœºï¼Œå…¨éƒ¨é€šè¿‡å°±æ’åˆ°æœ€åä¸€ä¸ªç´ æ•°çš„åé¢ã€‚</li>
</ul>
<p>å¯¹äº<code>linux</code>ä¸‹<code>pipe</code>å’Œ<code>fork</code>çš„ç†è§£ï¼š</p>
<ul>
<li>æ¯æ¬¡æ‰§è¡Œ<code>fork</code>çš„æ—¶å€™ï¼Œç³»ç»Ÿå¤åˆ¶æ•´ä»½ç¨‹åºï¼ˆåŒ…æ‹¬è¿è¡ŒçŠ¶æ€ï¼‰ã€‚<code>fork</code>åï¼Œä¸€ä»½è¿›ç¨‹å°†å˜ä¸ºä¸¤ä»½ï¼Œä»–ä»¬çš„åŒºåˆ«åªæœ‰<code>fork</code>è¿”å›çš„<code>pid</code>ã€‚</li>
<li><code>pipe</code>ç”¨äºä¸¤ä¸ªç¨‹åºé—´çš„é€šä¿¡ã€‚æ¯ä¸ª<code>pipe</code>ä¼šæœ‰ä¸¤ä¸ªå£ï¼Œåˆ†åˆ«ç”¨äºæ”¾è¿›ä¿¡æ¯å’Œå–å‡ºä¿¡æ¯ã€‚<code>pipe</code>å®é™…ä¸Šå°±æ˜¯<code>linux</code>ä¸‹çš„æ–‡ä»¶ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="err">```</span><span class="n">cpp</span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cassert&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;unistd.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">PRIME_BEGIN</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">PRIME_END</span> <span class="o">=</span> <span class="mi">101</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="n">PRIME_END</span> <span class="o">-</span> <span class="n">PRIME_BEGIN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">read_int</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">char</span> <span class="n">r_buf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">res</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">read</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">r_buf</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">sscanf</span><span class="p">(</span><span class="n">r_buf</span><span class="p">,</span> <span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">write_int</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">char</span> <span class="n">w_buf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">w_buf</span><span class="p">,</span> <span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">num</span><span class="p">);</span>
    <span class="n">write</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">w_buf</span><span class="p">,</span> <span class="mi">128</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">pipes</span><span class="p">[</span><span class="n">MAXN</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">pcnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// [][0] - read,  [][1] - write
</span><span class="c1"></span><span class="kt">int</span> <span class="n">pipe_ret</span><span class="p">,</span> <span class="n">id</span><span class="p">;</span>

<span class="cm">/*
</span><span class="cm">    |   Number Generator    |        |  Individual  1   |        |  Individual 2    |
</span><span class="cm">    |                       |   -&gt;   |                  |   -&gt;   |                  |
</span><span class="cm">id: |           0           | pipe 0 |         1        | pipe 1 |        2         |
</span><span class="cm">
</span><span class="cm">previous pipe   : id - 1
</span><span class="cm">next pipe       : id
</span><span class="cm">*/</span>

<span class="kt">int</span><span class="o">*</span> <span class="nf">previous</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">pipes</span><span class="p">[</span><span class="n">id</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">int</span><span class="o">*</span> <span class="nf">next</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">pipes</span><span class="p">[</span><span class="n">id</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">pipe_ret</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="n">next</span><span class="p">());</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">pipe_ret</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// Assume success
</span><span class="c1"></span>    <span class="n">id</span> <span class="o">=</span> <span class="n">pcnt</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Parent
</span><span class="c1"></span>        <span class="k">goto</span> <span class="n">Label_1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Child
</span><span class="c1"></span>        <span class="k">goto</span> <span class="n">Label_2</span><span class="p">;</span>
    <span class="p">}</span>

<span class="nl">Label_1</span><span class="p">:</span> <span class="c1">// [1] Number Generator
</span><span class="c1"></span>    <span class="n">close</span><span class="p">(</span><span class="n">next</span><span class="p">()[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">PRIME_BEGIN</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">PRIME_END</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">write_int</span><span class="p">(</span><span class="n">next</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">close</span><span class="p">(</span><span class="n">next</span><span class="p">()[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">Label_2</span><span class="p">:</span> <span class="c1">// [2] Individual
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="c1">// [2] Start
</span><span class="c1"></span>    <span class="n">id</span> <span class="o">=</span> <span class="n">pcnt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// next id = previous pipe + 1
</span><span class="c1"></span>    <span class="n">n</span> <span class="o">=</span> <span class="n">read_int</span><span class="p">(</span><span class="n">previous</span><span class="p">()[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;prime %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">m</span><span class="p">;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">read_int</span><span class="p">(</span><span class="n">previous</span><span class="p">()[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">m</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">m</span> <span class="o">%</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span> <span class="c1">// Not a prime
</span><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="n">pcnt</span> <span class="o">&lt;</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">++</span><span class="n">pcnt</span><span class="p">;</span>
            <span class="n">pipe_ret</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="n">next</span><span class="p">());</span>
            <span class="n">assert</span><span class="p">(</span><span class="n">pipe_ret</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">pid_next</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
            <span class="k">if</span><span class="p">(</span><span class="n">pid_next</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Child
</span><span class="c1"></span>                <span class="k">goto</span> <span class="n">Label_2</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">close</span><span class="p">(</span><span class="n">next</span><span class="p">()[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="n">write_int</span><span class="p">(</span><span class="n">next</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">);</span> <span class="c1">// pass to the right
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="trace-it">ğŸ•Trace it!</h2>
<blockquote>
<p>å®ç°ä¸€ä¸ª<code>traceroute</code>ã€‚</p>
</blockquote>
<p><code>traceroute</code>æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š<code>ICMP</code>å’Œ<code>UDP</code>ã€‚è¿™é‡Œä»‹ç»<code>ICMP</code>æ–¹å¼ã€‚</p>
<p><code>ICMP</code>æ˜¯å’Œ<code>IP</code>å¹¶åˆ—çš„åè®®ï¼Œç”¨äºä¼ è¾“å‡ºé”™æŠ¥å‘Šã€æ§åˆ¶ä¿¡æ¯ã€‚å…·ä½“çš„<code>ICMP</code>æŠ¥æ–‡å¯ä»¥ä¸Šç½‘æŸ¥ã€‚å¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦è‡ªè¡Œæ„é€ <code>ICMP</code>æŠ¥æ–‡ï¼Œå¹¶ä¸”æ§åˆ¶<code>TTL</code>ä»<code>1</code>å¼€å§‹é€’å¢ï¼Œæš´åŠ›å¾—åˆ°æ¯ä¸€å±‚èŠ‚ç‚¹å³å¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">select</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># ä¸€äº›å¸¸æ•°</span>
<span class="n">MAX_TTL_NUM</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">MAX_TIMEOUT_NUM</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># checksum æ£€éªŒç çš„è®¡ç®—</span>
<span class="k">def</span> <span class="nf">check_sum</span><span class="p">(</span><span class="n">strings</span><span class="p">):</span>
    <span class="n">csum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">countTo</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">countTo</span><span class="p">:</span>
        <span class="n">thisVal</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span> <span class="o">+</span> <span class="n">strings</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
        <span class="n">csum</span> <span class="o">=</span> <span class="n">csum</span> <span class="o">+</span> <span class="n">thisVal</span>
        <span class="n">csum</span> <span class="o">=</span> <span class="n">csum</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">countTo</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">strings</span><span class="p">):</span>
        <span class="n">csum</span> <span class="o">=</span> <span class="n">csum</span> <span class="o">+</span> <span class="n">strings</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">csum</span> <span class="o">=</span> <span class="n">csum</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span>
    <span class="n">csum</span> <span class="o">=</span> <span class="p">(</span><span class="n">csum</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">csum</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span>
    <span class="n">csum</span> <span class="o">=</span> <span class="n">csum</span> <span class="o">+</span> <span class="p">(</span><span class="n">csum</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="o">~</span><span class="n">csum</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">answer</span> <span class="o">&amp;</span> <span class="mh">0xffff</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">answer</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="p">(</span><span class="n">answer</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">answer</span>

<span class="c1"># æŸ¥è¯¢æŠ¥æ–‡-å›æ˜¾è¯·æ±‚</span>
<span class="n">ICMP_REQUEST_TYPE</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">ICMP_REQUEST_CODE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># å·®é”™æŠ¥æ–‡-ç«¯å£ä¸å¯è¾¾</span>
<span class="n">ICMP_UN_PORT_TYPE</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">ICMP_UN_PORT_CODE</span> <span class="o">=</span> <span class="mi">3</span>
<span class="c1"># å·®é”™æŠ¥æ–‡-TTLä¸º0</span>
<span class="n">ICMP_TTL_0_TYPE</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">ICMP_TTL_0_CODE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># æŸ¥è¯¢æŠ¥æ–‡-å›æ˜¾yåº”ç­”</span>
<span class="n">ICMP_ECHO_TYPE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ICMP_ECHO_CODE</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># make_icmp_head åˆ¶ä½œä¸€ä¸ª icmp æŠ¥å¤´</span>
<span class="c1"># icmp æŠ¥å¤´ï¼š[1]ç±»å‹ [1]ä»£ç  [2]æ£€éªŒå’Œ [2]æ ‡è¯†ç¬¦ [2]åºåˆ—å·</span>
<span class="k">def</span> <span class="nf">make_icmp_head</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&#34;d&#34;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&#34;bbHHh&#34;</span><span class="p">,</span>
        <span class="n">ICMP_REQUEST_TYPE</span><span class="p">,</span>
        <span class="n">ICMP_REQUEST_CODE</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span>
        <span class="mi">0</span> <span class="c1"># éšæ„</span>
    <span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">htons</span><span class="p">(</span><span class="n">check_sum</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&#34;bbHHh&#34;</span><span class="p">,</span>
        <span class="n">ICMP_REQUEST_TYPE</span><span class="p">,</span>
        <span class="n">ICMP_REQUEST_CODE</span><span class="p">,</span>
        <span class="nb">sum</span><span class="p">,</span>
        <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span>
        <span class="mi">0</span> <span class="c1"># éšæ„</span>
    <span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">message</span>

<span class="c1"># Traceroute åŸºäº ICMP çš„ä¸»ç¨‹åº</span>
<span class="k">def</span> <span class="nf">traceroute</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Traceroute -&gt; </span><span class="si">{0}</span><span class="s2">[</span><span class="si">{1}</span><span class="s2">]&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">address</span><span class="p">)))</span>
    <span class="c1"># å¾ªç¯ ttl</span>
    <span class="k">for</span> <span class="n">ttl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX_TTL_NUM</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[TTL = </span><span class="si">{0}</span><span class="s2">] &#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ttl</span><span class="p">),</span> <span class="n">end</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
        <span class="c1"># é‡‡ç”¨ raw å½¢å¼ï¼Œè‡ªå®šä¹‰ ICMP æŠ¥å¤´</span>
        <span class="n">icmp_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span>
            <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span>
            <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_RAW</span><span class="p">,</span>
            <span class="n">socket</span><span class="o">.</span><span class="n">getprotobyname</span><span class="p">(</span><span class="s2">&#34;icmp&#34;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># è®¾å®šé»˜è®¤çš„ ip æŠ¥å¤´</span>
        <span class="n">icmp_socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span>
            <span class="n">socket</span><span class="o">.</span><span class="n">IPPROTO_IP</span><span class="p">,</span>
            <span class="n">socket</span><span class="o">.</span><span class="n">IP_TTL</span><span class="p">,</span>
            <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&#34;I&#34;</span><span class="p">,</span> <span class="n">ttl</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># è®¾å®š ICMP çš„è¶…æ—¶æ—¶é—´</span>
        <span class="n">icmp_socket</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">MAX_TIMEOUT_NUM</span><span class="p">)</span>
        <span class="c1"># å‘é€è¯·æ±‚</span>
        <span class="n">icmp_socket</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">make_icmp_head</span><span class="p">(),</span> <span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">33434</span><span class="p">))</span>
        <span class="c1"># è®¡æ—¶</span>
        <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">icmp_socket</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">MAX_TIMEOUT_NUM</span><span class="p">)</span>
        <span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">time_all</span> <span class="o">=</span> <span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span>
        <span class="c1"># åˆ¤æ–­æ˜¯å¦è¶…æ—¶</span>
        <span class="k">if</span> <span class="n">time_all</span> <span class="o">&gt;=</span> <span class="n">MAX_TIMEOUT_NUM</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;***&#34;</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%.2f</span><span class="s2">ms&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time_all</span><span class="p">),</span> <span class="n">end</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span><span class="p">)</span>
        <span class="c1"># å¾—åˆ° ICMP æŠ¥å¤´</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">message</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">icmp_socket</span><span class="o">.</span><span class="n">recvfrom</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Timeout&#34;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">icmp_header</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span>
            <span class="n">icmp_type</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&#34;bbHHh&#34;</span><span class="p">,</span> <span class="n">icmp_header</span><span class="p">)</span>
            <span class="c1"># åˆ¤æ–­ç±»å‹</span>
            <span class="k">if</span> <span class="n">icmp_type</span> <span class="o">==</span> <span class="n">ICMP_UN_PORT_TYPE</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Reached but port denied, Address = </span><span class="si">{0}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="n">icmp_type</span> <span class="o">==</span> <span class="n">ICMP_TTL_0_TYPE</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Midway, Address = </span><span class="si">{0}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">icmp_type</span> <span class="o">==</span> <span class="n">ICMP_ECHO_TYPE</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Reached, Address = </span><span class="si">{0}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">return</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">address</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Traceroute Address: &#34;</span><span class="p">)</span>
    <span class="n">traceroute</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
</code></pre></div><h2 id="hello-bravenewworld">ğŸ­Hello BraveNewWorld</h2>
<blockquote>
<p>ä¸ä½¿ç”¨æ“ä½œç³»ç»Ÿï¼Œåœ¨ç”µè„‘ä¸Šè¾“å‡º<code>&quot;Hello World&quot;</code>ã€‚</p>
</blockquote>
<p><del>ä½ å¯ä»¥åœ¨çº¸ä¸Šå†™<code>&quot;Hello World&quot;</code>ç„¶åçœ‹çœ‹å‡ºé¢˜äººç»™ä¸ç»™ä½ è¿‡ã€‚</del></p>
<p>ä¸ä½¿ç”¨æ“ä½œç³»ç»Ÿï¼Œæˆ‘ä»¬å°±è‡ªå·±å†™ä¸€ä¸ªï¼ˆbushiï¼‰ã€‚</p>
<p>é™¤äº†è‡ªå·±å†™ä¸€ä¸ªæ“ä½œç³»ç»Ÿè¿™ç§æ–¹å¼å¤–ï¼Œæˆ‘ä»¬å…¶å®ä¹Ÿå¯ä»¥ä¸éœ€è¦æ“ä½œç³»ç»Ÿã€‚ä½ éœ€è¦å­¦ä¹ æ±‡ç¼–çš„åŸºæœ¬æ“ä½œå’Œä¸­æ–­ï¼Œè¿˜æœ‰ç³»ç»Ÿä»å“ªé‡Œå¯åŠ¨ä¹‹ç±»çš„çŸ¥è¯†ç‚¹ã€‚</p>
<p>æ¨èä¸€æœ¬ä¹¦ï¼šã€ŠOranges:ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„å®ç°ã€‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm">    <span class="nf">org</span> <span class="mi">07</span><span class="no">c00h</span>

    <span class="nf">mov</span> <span class="no">ax</span><span class="p">,</span> <span class="no">cs</span>
    <span class="nf">mov</span> <span class="no">es</span><span class="p">,</span> <span class="no">ax</span>
    <span class="nf">call</span> <span class="no">DisplayHelloWorld</span>
    <span class="nf">jmp</span> <span class="no">$</span>

<span class="nl">DisplayHelloWorld:</span>
    <span class="c">; è°ƒç”¨ä¸­æ–­ int 0x10
</span><span class="c"></span>    <span class="c">; å…¶ä¸­ ES:BP ä¸ºå­—ç¬¦ä¸²åœ°å€
</span><span class="c"></span>    <span class="c">; CX ä¸ºå­—ç¬¦ä¸²é•¿åº¦
</span><span class="c"></span>    <span class="c">; AH = 13: æ˜¾ç¤ºå­—ç¬¦ä¸²
</span><span class="c"></span>    <span class="c">; AL = 1: å…‰æ ‡è·Ÿéšç§»åŠ¨
</span><span class="c"></span>    <span class="c">; DL = 2: å¼€å§‹çš„åˆ—ä¸º 2
</span><span class="c"></span>    <span class="c">; BH = 0: é¡µå·ä¸º 0
</span><span class="c"></span>    <span class="c">; BL = 0: çº¢å­—é«˜äº®
</span><span class="c"></span>    <span class="nf">mov</span> <span class="no">ax</span><span class="p">,</span> <span class="no">String</span>
    <span class="nf">mov</span> <span class="no">bp</span><span class="p">,</span> <span class="no">ax</span>
    <span class="nf">mov</span> <span class="no">cx</span><span class="p">,</span> <span class="mi">12</span>
    <span class="nf">mov</span> <span class="no">ax</span><span class="p">,</span> <span class="mi">01301</span><span class="no">h</span>
    <span class="nf">mov</span> <span class="no">bx</span><span class="p">,</span> <span class="mi">000</span><span class="no">ch</span>
    <span class="nf">mov</span> <span class="no">dl</span><span class="p">,</span> <span class="mi">2</span>
    <span class="nf">int</span> <span class="mi">10</span><span class="no">h</span>
    <span class="nf">ret</span>

<span class="nl">String:</span> <span class="nf">db</span> <span class="err">&#34;</span><span class="no">Hello</span> <span class="no">World</span><span class="p">!</span><span class="err">&#34;</span>

<span class="nf">times</span> <span class="mi">510</span><span class="p">-(</span><span class="no">$-$$</span><span class="p">)</span> <span class="no">db</span> <span class="mi">0</span>
<span class="nf">dw</span> <span class="mi">0xaa55</span>
</code></pre></div><h2 id="proxy-with-cache">ğŸ“²Proxy with Cache</h2>
<blockquote>
<p>å®ç°ä¸€ä¸ªå¸¦ç¼“å­˜çš„<code>http</code>ä»£ç†æœåŠ¡å™¨ã€‚å…è®¸ä½¿ç”¨åˆ«çš„åº“ã€‚</p>
</blockquote>
<p>ä½ éœ€è¦çŸ¥é“<code>http</code>çš„ç¼“å­˜æœºåˆ¶ï¼ˆæ¯”å¦‚æ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªé¡µé¢æ˜¯å¦è¿‡æœŸï¼‰ï¼Œä¹Ÿè¦çŸ¥é“<code>HTTP</code>åè®®åœ¨ç½‘ç»œç»“æ„ä¸­çš„ä½ç½®å’Œä½œç”¨ï¼ˆè¿™æœ‰åŠ©äºä½ å¿«é€Ÿå…¥é—¨<code>go</code>çš„ç½‘ç»œåº“<code>net/http</code>ï¼‰ã€‚</p>
<p>è¿™äº›ç½‘é¡µå¯èƒ½å¯¹ä½ æœ‰å¸®åŠ©ï¼š</p>
<ul>
<li><a href="https://www.jianshu.com/p/ef892323e68f" target="_blank" rel="noopener noreffer">TCPåè®®è¯¦è§£</a></li>
<li><a href="https://www.jianshu.com/p/74153d906e77" target="_blank" rel="noopener noreffer">httpæŠ¥æ–‡è¯¦è§£</a></li>
<li><a href="https://www.jianshu.com/p/49ebc4a78474" target="_blank" rel="noopener noreffer">HTTP headè¯·æ±‚</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/128000072" target="_blank" rel="noopener noreffer">ä¸‡å­—é•¿æ–‡ï¼Œä¸€æ–‡ææ‡‚TCPã€IPå’ŒHTTPã€HTTPS</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/143346084" target="_blank" rel="noopener noreffer">Go è¯­è¨€ä½¿ç”¨ net åŒ…å®ç° Socket ç½‘ç»œç¼–ç¨‹</a></li>
<li><a href="https://www.cnblogs.com/xyjsw/archive/2010/01/27/1657825.html" target="_blank" rel="noopener noreffer">Webç¼“å­˜</a></li>
<li><a href="https://www.cnblogs.com/huansky/p/14420721.html" target="_blank" rel="noopener noreffer">æ·±å…¥è§£æ HTTP ç¼“å­˜æ§åˆ¶</a></li>
<li><a href="https://www.jianshu.com/p/227cee9c8d15" target="_blank" rel="noopener noreffer">ä¸€æ–‡è¯»æ‡‚httpç¼“å­˜ï¼ˆè¶…è¯¦ç»†ï¼‰</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/58685072" target="_blank" rel="noopener noreffer">HTTP ç¼“å­˜æœºåˆ¶</a></li>
<li><a href="https://pkg.go.dev/net/http#Request" target="_blank" rel="noopener noreffer">Go http</a></li>
</ul>
<p>å®é™…ä¸Šï¼Œé¢˜ç›®è¦æ±‚çš„åŠ å¯†ä¸ä¸€å®šè¦ç”¨<code>ssl</code>ã€‚å‡ºé¢˜äººçš„æ„æ€æ˜¯ï¼Œä½ å†™ä¸ªå‡¯æ’’åŠ å¯†éƒ½è¡Œï¼Œèƒ½ç”¨å°±å¯ä»¥ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// proxache.go
</span><span class="c1"></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;fmt&#34;</span>
    <span class="s">&#34;io/ioutil&#34;</span>
    <span class="s">&#34;net/http&#34;</span>
    <span class="s">&#34;time&#34;</span>

    <span class="s">&#34;github.com/fanjindong/go-cache&#34;</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="nx">myCache</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">ICache</span>

<span class="kd">type</span> <span class="nx">CacheElement</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">content</span>       <span class="p">[]</span><span class="kt">byte</span>
    <span class="nx">etag</span>          <span class="kt">string</span>
    <span class="nx">last_modified</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">proxache</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">request</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;METHOD[%s] URL[%s] %s\n&#34;</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">URL</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">RequestURI</span><span class="p">)</span>

    <span class="nx">client</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{}</span>

    <span class="nx">req</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">NewRequest</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">RequestURI</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;New Request err, err =&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">request</span><span class="p">.</span><span class="nx">Header</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">vv</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">v</span> <span class="p">{</span>
            <span class="nx">req</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">vv</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Get response err, err =&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>

    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Header</span> <span class="p">{</span>
        <span class="nx">w</span><span class="p">.</span><span class="nf">Header</span><span class="p">()[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">value</span>
    <span class="p">}</span>

    <span class="nx">res</span><span class="p">,</span> <span class="nx">stat</span> <span class="o">:=</span> <span class="nx">myCache</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
    <span class="c1">// stat ä¸ºfalseè¡¨ç¤ºéœ€è¦æ›´æ–°ç¼“å­˜
</span><span class="c1"></span>    <span class="nx">currentEtag</span> <span class="o">:=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;Etag&#34;</span><span class="p">)</span>
    <span class="nx">currentIfNoneMatch</span> <span class="o">:=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;If-None-Match&#34;</span><span class="p">)</span>
    <span class="nx">currentLastModified</span> <span class="o">:=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;Last-Modified&#34;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">stat</span> <span class="p">{</span> <span class="c1">// å­˜åœ¨è¿™ä¸ªç¼“å­˜ï¼Œå¼€å§‹åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ç¼“å­˜
</span><span class="c1"></span>        <span class="c1">// åˆ¤æ–­ Etag å’Œ If-None-Match
</span><span class="c1"></span>        <span class="k">if</span> <span class="nx">currentIfNoneMatch</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">res</span><span class="p">.(</span><span class="nx">CacheElement</span><span class="p">).</span><span class="nx">etag</span> <span class="o">!=</span> <span class="nx">currentIfNoneMatch</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;    Not the newest page - If-None-Match\n&#34;</span><span class="p">)</span>
            <span class="nx">stat</span> <span class="p">=</span> <span class="kc">false</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// åˆ¤æ–­ Last-Modified
</span><span class="c1"></span>            <span class="k">if</span> <span class="nx">currentIfNoneMatch</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">res</span><span class="p">.(</span><span class="nx">CacheElement</span><span class="p">).</span><span class="nx">last_modified</span> <span class="o">!=</span> <span class="nx">currentLastModified</span> <span class="p">{</span>
                <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;    Not the newest page - Last-Modified\n&#34;</span><span class="p">)</span>
                <span class="nx">stat</span> <span class="p">=</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">!</span><span class="nx">stat</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;    First time accessing\n&#34;</span><span class="p">)</span>
        <span class="nx">fileContent</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Read file err, err =&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="nx">w</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="nx">fileContent</span><span class="p">)</span>
        <span class="nx">myCache</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nf">String</span><span class="p">(),</span> <span class="nx">CacheElement</span><span class="p">{</span><span class="nx">fileContent</span><span class="p">,</span> <span class="nx">currentEtag</span><span class="p">,</span> <span class="nx">currentLastModified</span><span class="p">})</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;    Not first time accessing\n&#34;</span><span class="p">)</span>
        <span class="nx">w</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="nx">res</span><span class="p">.(</span><span class="nx">CacheElement</span><span class="p">).</span><span class="nx">content</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">myCache</span> <span class="p">=</span> <span class="nx">cache</span><span class="p">.</span><span class="nf">NewMemCache</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nf">WithClearInterval</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">))</span>

    <span class="nx">http</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="nx">proxache</span><span class="p">)</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;127.0.0.1:8000&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;http listen failed.&#34;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="è®¡ç®—å™¨">ğŸ˜˜è®¡ç®—å™¨</h2>
<blockquote>
<p>ä¸ä½¿ç”¨è¯­è¨€è‡ªå¸¦çš„<code>eval</code>å‡½æ•°ï¼Œè®¡ç®—ä¸€ä¸ªå­—ç¬¦ä¸²æ‰€ä»£è¡¨çš„è¡¨è¾¾å¼çš„å€¼ã€‚</p>
</blockquote>
<p>ä½ éœ€è¦è¯»ä¸€ä¸‹ã€Šç¼–è¯‘åŸç†ã€‹çš„å‰å‡ ç« ã€‚</p>
<p>é™„ä¸Šå½“æ—¶äº¤çš„wpé‡Œçš„ä¸­é—´è¿‡ç¨‹ï¼š</p>
<blockquote>
<ul>
<li>
<p>ä¸Šä¸‹æ–‡æ— å…³è¯­æ³•</p>
<p>$$Tint \rightarrow Tint||Tint |0|1|2|3|4|5|6|7|8|9$$</p>
<p>$$Tfloat \rightarrow Tint . Tint | Tint$$</p>
<p>$$elem \rightarrow Tfloat | (expr_1)$$</p>
<p>$$expr_0 \rightarrow elem \space rest_0 | expr_0 \space rest_0$$</p>
<p>$$rest_0 \rightarrow \times elem | / elem | \epsilon$$</p>
<p>$$expr_1 \rightarrow expr_0 \space rest_1 | expr_1 \space rest_1$$</p>
<p>$$rest_1 \rightarrow + expr_0 | -expr_0 | \epsilon$$</p>
</li>
<li>
<p>å¯¹äº ^ çš„æ‰©å±•ï¼ˆä¸è€ƒè™‘å³ç»“åˆè¿ç®—ç¬¦å’ŒéäºŒå…ƒè¿ç®—ç¬¦ï¼‰</p>
<p>æ³¨æ„è¿™å››ä¸ªå¼å­ï¼š</p>
<p>$$expr_0 \rightarrow elem \space rest_0 | expr_0 \space rest_0$$</p>
<p>$$rest_0 \rightarrow \times elem | / elem | \epsilon$$</p>
<p>$$expr_1 \rightarrow expr_0 \space rest_1 | expr_1 \space rest_1$$</p>
<p>$$rest_1 \rightarrow + expr_0 | -expr_0 | \epsilon$$
æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œå¯¹äº$m$ä¸ªä¼˜å…ˆçº§ä¸º$i$ï¼ˆ$i$è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰çš„äºŒå…ƒè¿ç®—ç¬¦ï¼Œ$expr_i$å’Œ$rest_i$åªéœ€å†™ä½œï¼š</p>
<p>$$expr_i \rightarrow expr_{i-1} \space rest_i | expr_i \space rest_i$$</p>
<p>$$rest_i \rightarrow \space opr_{i, j} \space expr_{i-1} | \epsilon, j \in [1, m]$$</p>
<p>ï¼ˆå½“$i=0$æ—¶ï¼Œå¹¶ä¸æ˜¯è°ƒç”¨$expr_{-1}$è€Œæ˜¯è°ƒç”¨$elem$ï¼‰ï¼›</p>
<p>ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å‡ºæ— é™â€œé˜¶â€çš„$expr$å’Œ$rest$ï¼Œå¹¶ä¸”åŠ¨æ€æ‰©å±•éœ€è¦ä½¿ç”¨çš„å‡½æ•°ã€‚</p>
</li>
</ul>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cctype&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;list&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAXN</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">enum</span> <span class="nc">Type</span> <span class="p">{</span>
    <span class="n">T_INVALID</span><span class="p">,</span>
    <span class="n">T_INT</span><span class="p">,</span>
    <span class="n">T_OPERATOR</span><span class="p">,</span> <span class="c1">// The property of operator { + - * / . }
</span><span class="c1"></span><span class="p">};</span>

<span class="k">struct</span> <span class="nc">Token</span>
<span class="p">{</span>
    <span class="n">Token</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">T_INVALID</span><span class="p">;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&#34; &#34;</span><span class="p">);</span>
        <span class="k">switch</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nl">T_INVALID</span><span class="p">:</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;&lt;&gt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="k">case</span> <span class="nl">T_INT</span><span class="p">:</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;&lt;int, %d&gt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">T_OPERATOR</span><span class="p">:</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;&lt;%c&gt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">Type</span> <span class="n">type</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">Node</span>
<span class="p">{</span>
    <span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">token</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">j</span> <span class="p">:</span> <span class="n">children</span><span class="p">)</span>
            <span class="n">j</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">Token</span> <span class="n">token</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">children</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">PredictiveParser</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">Node</span> <span class="n">process</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
        <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">Node</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">expr</span><span class="p">(</span><span class="n">oprs</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">!=</span> <span class="n">m</span><span class="p">)</span>
            <span class="n">error</span><span class="p">(</span><span class="s">&#34;[Process] Not fully processed&#34;</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Processed at %d/%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">registerOperator</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span><span class="p">(</span><span class="n">oprs</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">level</span><span class="p">)</span>
            <span class="n">oprs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">());</span>
        <span class="n">oprs</span><span class="p">[</span><span class="n">level</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">error</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">s</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">char</span> <span class="nf">lookahead</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="n">m</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">match</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">++</span><span class="n">m</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="n">error</span><span class="p">(</span><span class="s">&#34;[Match] does&#39;t match&#34;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">Node</span> <span class="nf">Tint</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Node</span> <span class="n">ans</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">isdigit</span><span class="p">(</span><span class="n">lookahead</span><span class="p">()))</span> <span class="p">{</span>
            <span class="n">ans</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ans</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">value</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">lookahead</span><span class="p">()</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
            <span class="n">match</span><span class="p">(</span><span class="n">lookahead</span><span class="p">());</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">error</span><span class="p">(</span><span class="s">&#34;[Tint] Require at least one word&#34;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">ans</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">T_INT</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Node</span> <span class="nf">Tfloat</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Node</span> <span class="n">ans</span><span class="p">;</span>
        <span class="n">ans</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Tint</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">lookahead</span><span class="p">()</span> <span class="o">==</span> <span class="sc">&#39;.&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">match</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">);</span>
            <span class="n">ans</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Tint</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="n">ans</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">T_OPERATOR</span><span class="p">;</span>
        <span class="n">ans</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="sc">&#39;.&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Node</span> <span class="nf">elem</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Node</span> <span class="n">ans</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">lookahead</span><span class="p">()</span> <span class="o">==</span> <span class="sc">&#39;(&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">match</span><span class="p">(</span><span class="sc">&#39;(&#39;</span><span class="p">);</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">expr</span><span class="p">(</span><span class="n">oprs</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">match</span><span class="p">(</span><span class="sc">&#39;)&#39;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">Tfloat</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Node</span> <span class="nf">rest</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Node</span> <span class="n">ans</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">lookahead</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// epsilon
</span><span class="c1"></span>            <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">i</span> <span class="p">:</span> <span class="n">oprs</span><span class="p">[</span><span class="n">level</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">lookahead</span><span class="p">()</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">ans</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">T_OPERATOR</span><span class="p">;</span>
                <span class="n">ans</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
                <span class="n">match</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="n">ans</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">Node</span> <span class="nf">expr</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">level</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">elem</span><span class="p">();</span>
        <span class="n">Node</span> <span class="n">ans</span><span class="p">;</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">expr</span><span class="p">(</span><span class="n">level</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
            <span class="n">Node</span> <span class="n">nxt</span> <span class="o">=</span> <span class="n">rest</span><span class="p">(</span><span class="n">level</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">nxt</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">T_INVALID</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">nxt</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="n">push_front</span><span class="p">(</span><span class="n">ans</span><span class="p">);</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="n">nxt</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span> <span class="n">oprs</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Calculator</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">registerFunction</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">fun</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">funs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">double</span> <span class="nf">value</span><span class="p">(</span><span class="k">const</span> <span class="n">Node</span><span class="o">&amp;</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nl">T_INT</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">o</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">T_OPERATOR</span><span class="p">:</span>
            <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">i</span> <span class="p">:</span> <span class="n">o</span><span class="p">.</span><span class="n">children</span><span class="p">)</span>
                <span class="n">values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
            <span class="k">if</span><span class="p">(</span><span class="n">funs</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">funs</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">funs</span><span class="p">[</span><span class="n">o</span><span class="p">.</span><span class="n">token</span><span class="p">.</span><span class="n">value</span><span class="p">](</span><span class="n">values</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">error</span><span class="p">(</span><span class="s">&#34;[Calculator] No operator&#34;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="kt">double</span> <span class="nf">toSmall</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">divide</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">c</span> <span class="o">/=</span> <span class="mi">10</span><span class="p">;</span>
            <span class="n">divide</span> <span class="o">*=</span> <span class="mi">10</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ans</span> <span class="o">/</span> <span class="n">divide</span><span class="p">;</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">error</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">s</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="p">)</span><span class="o">&gt;&gt;</span> <span class="n">funs</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Processer</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">process</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Node</span> <span class="n">ans</span><span class="p">;</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">P</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
            <span class="n">ans</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;= %lf</span><span class="se">\n\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">C</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">ans</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">puts</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
            <span class="n">puts</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;&gt; &#34;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">registerFunction</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">char</span> <span class="n">c</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">fun</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">C</span><span class="p">.</span><span class="n">registerFunction</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">fun</span><span class="p">);</span>
        <span class="n">P</span><span class="p">.</span><span class="n">registerOperator</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">PredictiveParser</span> <span class="n">P</span><span class="p">;</span>
    <span class="n">Calculator</span> <span class="n">C</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">Processer</span> <span class="n">S</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">S</span><span class="p">.</span><span class="n">registerFunction</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="sc">&#39;+&#39;</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">o</span><span class="p">.</span><span class="n">front</span><span class="p">()</span> <span class="o">+</span> <span class="n">o</span><span class="p">.</span><span class="n">back</span><span class="p">();</span> <span class="p">});</span>
    <span class="n">S</span><span class="p">.</span><span class="n">registerFunction</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="sc">&#39;-&#39;</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">o</span><span class="p">.</span><span class="n">front</span><span class="p">()</span> <span class="o">-</span> <span class="n">o</span><span class="p">.</span><span class="n">back</span><span class="p">();</span> <span class="p">});</span>
    <span class="n">S</span><span class="p">.</span><span class="n">registerFunction</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="sc">&#39;*&#39;</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">o</span><span class="p">.</span><span class="n">front</span><span class="p">()</span> <span class="o">*</span> <span class="n">o</span><span class="p">.</span><span class="n">back</span><span class="p">();</span> <span class="p">});</span>
    <span class="n">S</span><span class="p">.</span><span class="n">registerFunction</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="sc">&#39;/&#39;</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">o</span><span class="p">.</span><span class="n">front</span><span class="p">()</span> <span class="o">/</span> <span class="n">o</span><span class="p">.</span><span class="n">back</span><span class="p">();</span> <span class="p">});</span>
    <span class="n">S</span><span class="p">.</span><span class="n">registerFunction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="sc">&#39;^&#39;</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">pow</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">o</span><span class="p">.</span><span class="n">back</span><span class="p">());</span> <span class="p">});</span>
    <span class="n">S</span><span class="p">.</span><span class="n">registerFunction</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sc">&#39;.&#39;</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">o</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">o</span><span class="p">.</span><span class="n">front</span><span class="p">()</span> <span class="o">+</span> <span class="n">Calculator</span><span class="o">::</span><span class="n">toSmall</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">back</span><span class="p">());</span>
    <span class="p">});</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;&gt; &#34;</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="o">~</span><span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">S</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*
</span><span class="cm">(2^3+4)*(5+7)-3*4
</span><span class="cm">&gt; 132
</span><span class="cm">
</span><span class="cm">5.5^2*(3+4.2)
</span><span class="cm">&gt; 217.8
</span><span class="cm">
</span><span class="cm">(5+2*3^3
</span><span class="cm">&gt; [Match] does&#39;t match
</span><span class="cm">
</span><span class="cm">(.1+2)
</span><span class="cm">&gt; [Tint] Require at least one word
</span><span class="cm">
</span><span class="cm">(1*100)*20/5+1
</span><span class="cm">&gt; 401
</span><span class="cm">*/</span>
</code></pre></div><h2 id="lost-in-interpretation">ğŸ—¼Lost in Interpretation</h2>
<blockquote>
<p>ä½¿ç”¨<code>scheme</code>ç¼–å†™ä¸€ä¸ª<code>lisp</code>è§£é‡Šå™¨ã€‚å…è®¸å¯¹è¡¨æ±‚å€¼è€Œä¸æ˜¯å¯¹å­—ç¬¦ä¸²æ±‚å€¼ã€‚</p>
</blockquote>
<p>ä½ éœ€è¦è¯»ã€Šè®¡ç®—æœºç¨‹åºçš„æ„é€ å’Œè§£é‡Šã€‹çš„å‰å‡ ç« ã€‚</p>
<p>ï¼ˆæˆ‘æœ¬æ¥å¸Œæœ›è‡ªå·±å†™çš„<code>lisp</code>è§£é‡Šå™¨èƒ½è¿è¡Œ<code>lisp</code>è§£é‡Šå™¨ï¼Œç„¶åæŠŠè§£é‡Šå™¨è¿è¡Œè§£é‡Šå™¨çš„æˆªå›¾äº¤ä¸Šå»ï¼Œä½†æ˜¯æ²¡å¼„å‡ºæ¥ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scheme" data-lang="scheme"><span class="o">#</span><span class="nv">lang</span> <span class="nv">sicp</span>

<span class="c1">; åŸæœ‰çš„applyå‰¯æœ¬</span>
<span class="p">(</span><span class="k">define </span><span class="nv">apply-in-underlying-scheme</span> <span class="nv">apply</span><span class="p">)</span>

<span class="c1">; eval</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">eval </span><span class="nv">exp</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">self-evaluating?</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">exp</span><span class="p">)</span>
        <span class="p">((</span><span class="nf">variable?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">lookup-variable-value</span> <span class="nv">exp</span> <span class="nv">env</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">quoted?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">text-of-quotation</span> <span class="nv">exp</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">assignment?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">eval-assignment</span> <span class="nv">exp</span> <span class="nv">env</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">definition?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">eval-definition</span> <span class="nv">exp</span> <span class="nv">env</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">if?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">eval-if</span> <span class="nv">exp</span> <span class="nv">env</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">map?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">eval-map</span> <span class="nv">exp</span> <span class="nv">env</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">lambda?</span> <span class="nv">exp</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">make-procedure</span> <span class="p">(</span><span class="nf">lambda-parameters</span> <span class="nv">exp</span><span class="p">)</span>
                         <span class="p">(</span><span class="nf">lambda-body</span> <span class="nv">exp</span><span class="p">)</span>
                         <span class="nv">env</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">begin?</span> <span class="nv">exp</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">eval-sequence</span> <span class="p">(</span><span class="nf">begin-actions</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">env</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">cond?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">cond-&gt;if</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">env</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">let?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">let-&gt;combination</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">env</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">application?</span> <span class="nv">exp</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">myapply</span> <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">operator</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">env</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">list-of-values</span> <span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">env</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">else</span>
         <span class="p">(</span><span class="nf">error</span> <span class="s">&#34;Unknown expression type -- EVAL&#34;</span> <span class="nv">exp</span><span class="p">))))</span>

<span class="c1">; apply</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">myapply</span> <span class="nv">procedure</span> <span class="nv">arguments</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">primitive-procedure?</span> <span class="nv">procedure</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">apply-primitive-procedure</span> <span class="nv">procedure</span> <span class="nv">arguments</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">compound-procedure?</span> <span class="nv">procedure</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">eval-sequence</span>
          <span class="p">(</span><span class="nf">procedure-body</span> <span class="nv">procedure</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">extend-environment</span>
           <span class="p">(</span><span class="nf">procedure-parameters</span> <span class="nv">procedure</span><span class="p">)</span>
           <span class="nv">arguments</span>
           <span class="p">(</span><span class="nf">procedure-environment</span> <span class="nv">procedure</span><span class="p">))))</span>
        <span class="p">(</span><span class="nf">else</span>
         <span class="p">(</span><span class="nf">error</span> <span class="s">&#34;Unknown procedure type -- APPLY&#34;</span> <span class="nv">procedure</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">list-of-values</span> <span class="nv">exps</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">no-operands?</span> <span class="nv">exps</span><span class="p">)</span>
      <span class="o">&#39;</span><span class="p">()</span>
      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">first-operand</span> <span class="nv">exps</span><span class="p">)</span> <span class="nv">env</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">list-of-values</span> <span class="p">(</span><span class="nf">rest-operands</span> <span class="nv">exps</span><span class="p">)</span> <span class="nv">env</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">eval-if</span> <span class="nv">exp</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">true?</span> <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">if-predicate</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">env</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">if-consequent</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">env</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">if-alternative</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">env</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">eval-sequence</span> <span class="nv">exps</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">last-exp?</span> <span class="nv">exps</span><span class="p">)</span> <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">first-exp</span> <span class="nv">exps</span><span class="p">)</span> <span class="nv">env</span><span class="p">))</span>
        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">first-exp</span> <span class="nv">exps</span><span class="p">)</span> <span class="nv">env</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">eval-sequence</span> <span class="p">(</span><span class="nf">rest-exps</span> <span class="nv">exps</span><span class="p">)</span> <span class="nv">env</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">eval-assignment</span> <span class="nv">exp</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">set-variable-value!</span> <span class="p">(</span><span class="nf">assignment-variable</span> <span class="nv">exp</span><span class="p">)</span>
                       <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">assignment-value</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">env</span><span class="p">)</span>
                       <span class="nv">env</span><span class="p">)</span>
  <span class="ss">&#39;ok</span><span class="p">)</span> <span class="c1">; æœ€ç»ˆå…·æœ‰ä¸€ä¸ªè¿”å›å€¼</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">eval-definition</span> <span class="nv">exp</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-variable!</span> <span class="p">(</span><span class="nf">definition-variable</span> <span class="nv">exp</span><span class="p">)</span>
                    <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">definition-value</span> <span class="nv">exp</span><span class="p">)</span> <span class="nv">env</span><span class="p">)</span>
                    <span class="nv">env</span><span class="p">)</span>
  <span class="ss">&#39;ok</span><span class="p">)</span> <span class="c1">; æœ€ç»ˆå…·æœ‰ä¸€ä¸ªè¿”å›å€¼</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">self-evaluating?</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">number? </span><span class="nv">exp</span><span class="p">)</span> <span class="nv">true</span><span class="p">)</span>
        <span class="p">((</span><span class="nb">string? </span><span class="nv">exp</span><span class="p">)</span> <span class="nv">true</span><span class="p">)</span>
        <span class="p">(</span><span class="k">else </span><span class="nv">false</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">variable?</span> <span class="nv">exp</span><span class="p">)</span> <span class="c1">; å˜é‡ç”¨ç¬¦å·æ¥è¡¨ç¤º</span>
  <span class="p">(</span><span class="nb">symbol? </span><span class="nv">exp</span><span class="p">))</span>

<span class="c1">; quote</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">quoted?</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="o">`</span><span class="nv">quote</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="nv">tag</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">exp</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">eq? </span><span class="p">(</span><span class="nb">car </span><span class="nv">exp</span><span class="p">)</span> <span class="nv">tag</span><span class="p">)</span>
      <span class="nv">false</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">text-of-quotation</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cadr </span><span class="nv">exp</span><span class="p">))</span>

<span class="c1">; assignment</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">assignment?</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">&#39;set!</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">assignment-variable</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cadr </span><span class="nv">exp</span><span class="p">))</span> <span class="c1">; cadr: å…ˆ cdr å† car</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">assignment-value</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">caddr </span><span class="nv">exp</span><span class="p">))</span>

<span class="c1">; definition</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">definition?</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">&#39;define</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">definition-variable</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">symbol? </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">exp</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">cadr </span><span class="nv">exp</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">caadr </span><span class="nv">exp</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">definition-value</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">symbol? </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">exp</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">caddr </span><span class="nv">exp</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-lambda</span> <span class="p">(</span><span class="nb">cdadr </span><span class="nv">exp</span><span class="p">)</span>   <span class="c1">; formal parameters</span>
                   <span class="p">(</span><span class="nb">cddr </span><span class="nv">exp</span><span class="p">))))</span> <span class="c1">; body</span>

<span class="c1">; lambda</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">lambda?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">&#39;lambda</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">lambda-parameters</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">lambda-body</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cddr </span><span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-lambda</span> <span class="nv">parameters</span> <span class="nv">body</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="ss">&#39;lambda</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">parameters</span> <span class="nv">body</span><span class="p">)))</span>

<span class="c1">; if</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">if?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">&#39;if</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">if-predicate</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">if-consequent</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr </span><span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">if-alternative</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">null? </span><span class="p">(</span><span class="nb">cdddr </span><span class="nv">exp</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">cadddr </span><span class="nv">exp</span><span class="p">)</span>
      <span class="ss">&#39;false</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-if</span> <span class="nv">predictive</span> <span class="nv">consequent</span> <span class="nv">alternative</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;if</span> <span class="nv">predictive</span> <span class="nv">consequent</span> <span class="nv">alternative</span><span class="p">))</span>

<span class="c1">; begin</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">begin?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">&#39;begin</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">begin-actions</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">last-exp?</span> <span class="nv">seq</span><span class="p">)</span> <span class="p">(</span><span class="nb">null? </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">seq</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-exp</span> <span class="nv">seq</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">seq</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rest-exps</span> <span class="nv">seq</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">seq</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sequence-&gt;exp</span> <span class="nv">seq</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">seq</span><span class="p">)</span> <span class="nv">seq</span><span class="p">)</span>
        <span class="p">((</span><span class="nf">last-exp?</span> <span class="nv">seq</span><span class="p">)</span> <span class="p">(</span><span class="nf">first-exp</span> <span class="nv">seq</span><span class="p">))</span>
        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">make-begin</span> <span class="nv">seq</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-begin</span> <span class="nv">seq</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="ss">&#39;begin</span> <span class="nv">seq</span><span class="p">))</span>

<span class="c1">; application</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">application?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">pair? </span><span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">operator</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">operands</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">no-operands?</span> <span class="nv">ops</span><span class="p">)</span> <span class="p">(</span><span class="nb">null? </span><span class="nv">ops</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-operand</span> <span class="nv">ops</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">ops</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rest-operands</span> <span class="nv">ops</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">ops</span><span class="p">))</span>

<span class="c1">; cond</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cond?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">&#39;cond</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cond-clauses</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cond-else-clause?</span> <span class="nv">clause</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">eq? </span><span class="p">(</span><span class="nf">cond-predicate</span> <span class="nv">clause</span><span class="p">)</span> <span class="ss">&#39;else</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cond-predicate</span> <span class="nv">clause</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">clause</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cond-actions</span> <span class="nv">clause</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">clause</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cond-&gt;if</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">expand-clauses</span> <span class="p">(</span><span class="nf">cond-clauses</span> <span class="nv">exp</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">expand-clauses</span> <span class="nv">clauses</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">clauses</span><span class="p">)</span>
      <span class="ss">&#39;false</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">first</span> <span class="p">(</span><span class="nb">car </span><span class="nv">clauses</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">rest</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">clauses</span><span class="p">)))</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">cond-else-clause?</span> <span class="nv">first</span><span class="p">)</span>
            <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">rest</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">sequence-&gt;exp</span> <span class="p">(</span><span class="nf">cond-actions</span> <span class="nv">first</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">error</span> <span class="s">&#34;ELSE clause isn&#39;t last -- COND-&gt;IF&#34;</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">make-if</span> <span class="p">(</span><span class="nf">cond-predicate</span> <span class="nv">first</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">sequence-&gt;exp</span> <span class="p">(</span><span class="nf">cond-actions</span> <span class="nv">first</span><span class="p">))</span>
                     <span class="p">(</span><span class="nf">expand-clauses</span> <span class="nv">rest</span><span class="p">))))))</span>

<span class="c1">; è¿™ä¸€æ®µç•™ç»™ç»ƒä¹  4.6</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">let?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">&#39;let</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">let-clauses</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">exp</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">let-body</span> <span class="nv">clause</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">clause</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">let-variables</span> <span class="nv">clause</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">clause</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">let-&gt;combination</span> <span class="nv">exp</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">expand-let</span> <span class="p">(</span><span class="nf">let-clauses</span> <span class="nv">exp</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-combination</span> <span class="nv">vars</span> <span class="nv">body</span> <span class="nv">exps</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">make-lambda</span> <span class="nv">vars</span> <span class="nv">body</span><span class="p">)</span> <span class="nv">exps</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">make-lambda</span> <span class="nv">vars</span> <span class="nv">body</span><span class="p">)</span> <span class="nv">exps</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">expand-let</span> <span class="nv">clause</span><span class="p">)</span> <span class="c1">; (let ((x 1) (y 2)) (cons x y))</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">body</span> <span class="p">(</span><span class="nf">let-body</span> <span class="nv">clause</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">variables</span> <span class="p">(</span><span class="nf">let-variables</span> <span class="nv">clause</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">read-loop-first</span> <span class="nv">pairs</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">pairs</span><span class="p">)</span>
          <span class="o">&#39;</span><span class="p">()</span>
          <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="p">(</span><span class="nb">car </span><span class="nv">pairs</span><span class="p">))</span>
              <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">caar </span><span class="nv">pairs</span><span class="p">)</span> <span class="p">(</span><span class="nf">read-loop-first</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">pairs</span><span class="p">)))</span>
              <span class="p">(</span><span class="nf">error</span> <span class="s">&#34;LET expression lack of var -- expand-let&#34;</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">read-loop-second</span> <span class="nv">pairs</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">pairs</span><span class="p">)</span>
          <span class="o">&#39;</span><span class="p">()</span>
          <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="p">(</span><span class="nb">car </span><span class="nv">pairs</span><span class="p">))</span>
              <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">cadar </span><span class="nv">pairs</span><span class="p">)</span> <span class="p">(</span><span class="nf">read-loop-second</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">pairs</span><span class="p">)))</span>
              <span class="p">(</span><span class="nf">error</span> <span class="s">&#34;LET expression lack of exp -- expand-let&#34;</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">vars</span> <span class="p">(</span><span class="nf">read-loop-first</span> <span class="nv">variables</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">exps</span> <span class="p">(</span><span class="nf">read-loop-second</span> <span class="nv">variables</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">make-combination</span> <span class="nv">vars</span> <span class="nv">body</span> <span class="nv">exps</span><span class="p">))))</span>

<span class="c1">; è¿™é‡Œå®ç°ä¸€ä¸ªmap</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">map?</span> <span class="nv">exp</span><span class="p">)</span> <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">exp</span> <span class="ss">&#39;map</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">eval-map</span> <span class="nv">exp</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">proc</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">exp</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">alist</span> <span class="p">(</span><span class="nb">cddr </span><span class="nv">exp</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">apply-in-underlying-scheme</span>
     <span class="nv">map</span> 
     <span class="p">((</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">myapply</span> <span class="p">(</span><span class="nb">eval </span><span class="nv">proc</span> <span class="nv">env</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">x</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">list-of-values</span> <span class="nv">alist</span> <span class="nv">env</span><span class="p">)))))</span>

<span class="c1">; /è¿™ä¸€æ®µç•™ç»™ç»ƒä¹  4.6</span>


<span class="c1">; è¿™ä¸€æ®µç•™ç»™ç»ƒä¹  4.9</span>

<span class="c1">; /è¿™ä¸€æ®µç•™ç»™ç»ƒä¹  4.9</span>

<span class="c1">; verb</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">true?</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">eq? </span><span class="nv">x</span> <span class="nv">false</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">false?</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">eq? </span><span class="nv">x</span> <span class="nv">false</span><span class="p">))</span>

<span class="c1">; procedure</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-procedure</span> <span class="nv">parameters</span> <span class="nv">body</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;procedure</span> <span class="nv">parameters</span> <span class="nv">body</span> <span class="nv">env</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">compound-procedure?</span> <span class="nv">p</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">p</span> <span class="ss">&#39;procedure</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">procedure-parameters</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">p</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">procedure-body</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">caddr </span><span class="nv">p</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">procedure-environment</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadddr </span><span class="nv">p</span><span class="p">))</span>

<span class="c1">; environment</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">enclosing-environment</span> <span class="nv">env</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">env</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-frame</span> <span class="nv">env</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">env</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">the-empty-environment</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">())</span> <span class="c1">; æ³¨æ„è¿™é‡Œç†è®ºä¸Šåº”è¯¥å†™ &#39;()</span>

<span class="c1">; frame</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-frame</span> <span class="nv">variables</span> <span class="nv">values</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons </span><span class="nv">variables</span> <span class="nv">values</span><span class="p">))</span> <span class="c1">; è¿™ä¸ªè¡¨ç”±ä¸¤ä¸ªç­‰é•¿çš„è¡¨ç»„æˆï¼Œä¸€ä¸ªæ˜¯keyï¼Œä¸€ä¸ªæ˜¯value</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">frame-variables</span> <span class="nv">frame</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">frame</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">frame-values</span> <span class="nv">frame</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">frame</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-binding-to-frame!</span> <span class="nv">var</span> <span class="nv">val</span> <span class="nv">frame</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">set-car! </span><span class="nv">frame</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">var</span> <span class="p">(</span><span class="nb">car </span><span class="nv">frame</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">set-cdr! </span><span class="nv">frame</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">val</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">frame</span><span class="p">))))</span>

<span class="c1">; extending</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">extend-environment</span> <span class="nv">vars</span> <span class="nv">vals</span> <span class="nv">base-env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">length </span><span class="nv">vars</span><span class="p">)</span> <span class="p">(</span><span class="nb">length </span><span class="nv">vals</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">make-frame</span> <span class="nv">vars</span> <span class="nv">vals</span><span class="p">)</span> <span class="nv">base-env</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">length </span><span class="nv">vars</span><span class="p">)</span> <span class="p">(</span><span class="nb">length </span><span class="nv">vals</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">error</span> <span class="s">&#34;Too many arguments supplied&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">error</span> <span class="s">&#34;Too few arguments supplied&#34;</span><span class="p">))))</span>

<span class="c1">; set variable</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">lookup-variable-value</span> <span class="nv">var</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">env-loop</span> <span class="nv">env</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">scan</span> <span class="nv">vars</span> <span class="nv">vals</span><span class="p">)</span>
      <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">vars</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">env-loop</span> <span class="p">(</span><span class="nf">enclosing-environment</span> <span class="nv">env</span><span class="p">)))</span>
            <span class="p">((</span><span class="nb">eq? </span><span class="nv">var</span> <span class="p">(</span><span class="nb">car </span><span class="nv">vars</span><span class="p">))</span>
             <span class="p">(</span><span class="nb">car </span><span class="nv">vals</span><span class="p">))</span>
            <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">vars</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">vals</span><span class="p">)))))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">eq? </span><span class="nv">env</span> <span class="nv">the-empty-environment</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">error</span> <span class="s">&#34;Unbound variable&#34;</span> <span class="nv">var</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">frame</span> <span class="p">(</span><span class="nf">first-frame</span> <span class="nv">env</span><span class="p">)))</span>
          <span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nf">frame-variables</span> <span class="nv">frame</span><span class="p">)</span>
               <span class="p">(</span><span class="nf">frame-values</span> <span class="nv">frame</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nf">env-loop</span> <span class="nv">env</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">set-variable-value!</span> <span class="nv">var</span> <span class="nv">val</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">env-loop</span> <span class="nv">env</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">scan</span> <span class="nv">vars</span> <span class="nv">vals</span><span class="p">)</span>
      <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">vars</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">env-loop</span> <span class="p">(</span><span class="nf">enclosing-environment</span> <span class="nv">env</span><span class="p">)))</span>
            <span class="p">((</span><span class="nb">eq? </span><span class="nv">var</span> <span class="p">(</span><span class="nb">car </span><span class="nv">vars</span><span class="p">))</span>
             <span class="p">(</span><span class="nb">set-car! </span><span class="nv">vals</span> <span class="nv">val</span><span class="p">))</span>
            <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">vars</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">vals</span><span class="p">)))))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">eq? </span><span class="nv">env</span> <span class="nv">the-empty-environment</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">error</span> <span class="s">&#34;Unbound variable -- SET!&#34;</span> <span class="nv">var</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">frame</span> <span class="p">(</span><span class="nf">first-frame</span> <span class="nv">env</span><span class="p">)))</span>
          <span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nf">frame-variables</span> <span class="nv">frame</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">frame-values</span> <span class="nv">frame</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nf">env-loop</span> <span class="nv">env</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">define-variable!</span> <span class="nv">var</span> <span class="nv">val</span> <span class="nv">env</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">frame</span> <span class="p">(</span><span class="nf">first-frame</span> <span class="nv">env</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">scan</span> <span class="nv">vars</span> <span class="nv">vals</span><span class="p">)</span>
      <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">vars</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">add-binding-to-frame!</span> <span class="nv">var</span> <span class="nv">val</span> <span class="nv">frame</span><span class="p">))</span>
            <span class="p">((</span><span class="nb">eq? </span><span class="nv">var</span> <span class="p">(</span><span class="nb">car </span><span class="nv">vars</span><span class="p">))</span>
             <span class="p">(</span><span class="nb">set-car! </span><span class="nv">vals</span> <span class="nv">val</span><span class="p">))</span>
            <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">vars</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">vals</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nf">scan</span> <span class="p">(</span><span class="nf">frame-variables</span> <span class="nv">frame</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">frame-values</span> <span class="nv">frame</span><span class="p">))))</span>

<span class="c1">; setup</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">setup-environment</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">initial-env</span>
         <span class="p">(</span><span class="nf">extend-environment</span> <span class="p">(</span><span class="nf">primitive-procedure-names</span><span class="p">)</span>
                             <span class="p">(</span><span class="nf">primitive-procedure-objects</span><span class="p">)</span>
                             <span class="nv">the-empty-environment</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">define-variable!</span> <span class="ss">&#39;true</span> <span class="nv">true</span> <span class="nv">initial-env</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">define-variable!</span> <span class="ss">&#39;false</span> <span class="nv">false</span> <span class="nv">initial-env</span><span class="p">)</span>
    <span class="nv">initial-env</span><span class="p">))</span>

<span class="c1">; primitive procedure</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">primitive-procedure?</span> <span class="nv">proc</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">tagged-list?</span> <span class="nv">proc</span> <span class="ss">&#39;primitive</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">primitive-implementation</span> <span class="nv">proc</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">proc</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">primitive-procedures</span>
  <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">list </span><span class="ss">&#39;car</span> <span class="nv">car</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;cdr</span> <span class="nv">cdr</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;cons</span> <span class="nv">cons</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;null?</span> <span class="nv">null?</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;string?</span> <span class="nv">string?</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;number?</span> <span class="nv">number?</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;read</span> <span class="nv">read</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;display</span> <span class="nv">display</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;newline</span> <span class="nv">newline</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;apply</span> <span class="nv">apply</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;list</span> <span class="nv">list</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;+</span> <span class="nv">+</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;*</span> <span class="nv">*</span><span class="p">)</span>
        <span class="c1">; å…¶ä»–åŸºæœ¬è¿‡ç¨‹</span>
        <span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">primitive-procedure-names</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">map </span><span class="nv">car</span> <span class="nv">primitive-procedures</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">primitive-procedure-objects</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">proc</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;primitive</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">proc</span><span class="p">)))</span>
         <span class="nv">primitive-procedures</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">apply-primitive-procedure</span> <span class="nv">proc</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">apply-in-underlying-scheme</span>
   <span class="p">(</span><span class="nf">primitive-implementation</span> <span class="nv">proc</span><span class="p">)</span> <span class="nv">args</span><span class="p">))</span>

<span class="c1">; main</span>
<span class="p">(</span><span class="k">define </span><span class="nv">input-prompt</span> <span class="s">&#34;;;;M-Eval input:&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="nv">output-prompt</span> <span class="s">&#34;;;;M-Eval output:&#34;</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">the-global-environment</span> <span class="p">(</span><span class="nf">setup-environment</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">driver-loop</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">prompt-for-input</span> <span class="nv">input-prompt</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">input</span> <span class="p">(</span><span class="nf">read</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">output</span> <span class="p">(</span><span class="nb">eval </span><span class="nv">input</span> <span class="nv">the-global-environment</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">announce-output</span> <span class="nv">output-prompt</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">user-print</span> <span class="nv">output</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">driver-loop</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">prompt-for-input</span> <span class="nv">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">display </span><span class="nv">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">newline</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">announce-output</span> <span class="nv">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">display </span><span class="nv">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">newline</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">user-print</span> <span class="nv">object</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">compound-procedure?</span> <span class="nv">object</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nb">list </span><span class="ss">&#39;compound-procedure</span>
                     <span class="p">(</span><span class="nf">procedure-parameters</span> <span class="nv">object</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">procedure-body</span> <span class="nv">object</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">display </span><span class="nv">object</span><span class="p">)))</span>

<span class="c1">; event-loop</span>
<span class="p">(</span><span class="nf">driver-loop</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">append </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">x</span><span class="p">)</span>
      <span class="nv">y</span>
      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">x</span><span class="p">)</span> <span class="nv">y</span><span class="p">))))</span>

<span class="c1">; (append &#39;(1 2 3) &#39;(4 5))</span>
</code></pre></div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2021-11-01</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/dev/">Dev</a>,&nbsp;<a href="/tags/cnss-recruit/">Cnss Recruit</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/%E6%96%B0%E6%89%8B%E5%90%91/%E6%96%B0%E6%89%8B%E5%90%91stm32%E5%85%A5%E9%97%A8/" class="prev" rel="prev" title="ã€æ–°æ‰‹å‘ã€‘STM32å…¥é—¨"><i class="fas fa-angle-left fa-fw"></i>ã€æ–°æ‰‹å‘ã€‘STM32å…¥é—¨</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.87.0">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">XuKaFy</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":10},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
